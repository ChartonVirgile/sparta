<HTML>
<CENTER><A HREF = "http://sparta.sandia.gov">SPARTA WWW Site</A> - <A HREF = "Manual.html">SPARTA Documentation</A> - <A HREF = "Section_commands.html#comm">SPARTA Commands</A> 
</CENTER>






<HR>

<H3>fix dt command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>fix ID dt Nfreq avg_dt_weight transit_fraction collision_fraction lambda temperature usq vsq wsq mode extra 
</PRE>
<UL><LI>ID is documented in <A HREF = "fix.html">fix</A> command 

<LI>dt = style name of this fix command 

<LI>Nfreq = perform timestep calculation every this many steps 

<LI>avg_dt_weight = weight applied to average cell timestep when calculating the global timestep 

<LI>transit_fraction = fraction of the cell transit time used to calculate a cell candidate timestep 

<LI>collision_fraction = fraction of the cell mean collision time used to calculate a cell candidate timestep 

<LI>lambda = compute or fix column for mean free path, prefaced by "c_" or "f_" 

<LI>temperature = fix column for temperature, prefaced by "f_" 

<LI>usq = fix column for x component of velocity squared, prefaced by "f_" 

<LI>vsq = fix column for y component of velocity squared, prefaced by "f_" 

<LI>wsq = fix column for z component of velocity squared, prefaced by "f_" 

<LI>mode = <I>warn</I> or <I>use_calculated_dt</I> 

<LI>extra = <I>store_cell_dt</I> (optional) 


</UL>
<P><B>Examples:</B>
</P>
<PRE>fix DT dt 500 0.1 0.25 0.1 c_lambda f_1[2] f_1[3] f_1[4] f_1[5] warn
fix DT dt 500 0.1 0.25 0.1 f_lambda f_1[2] f_1[3] f_1[4] f_1[5] use_calculated_dt store_cell_dt 
</PRE>
<P>These commands will calculate a global timestep every 500 steps, either 1) using the user-provided timestep
and warning if it is greater than the calculated timestep or 2) using the calculated timestep and
ignoring the user-provided value.
</P>
<P><B>Description:</B>
</P>
<P>Calculate a global timestep based on cell mean collision and transit times. The user-suppled timestep is used prior to the
first invocation of this fix. Each time this fix is invoked, a candidate timestep is calculated in each cell, and then both an
average candidate timestep (dt_avg) and a minimum candidate timestep (dt_min) are computed over all cells.  The global timestep
is then determined using the formula:
</P>
<PRE>dt_global = (1-avg_dt_weight)*dt_min + avg_dt_weight*dt_avg 
</PRE>
<P>In the candidate timestep calculation for each cell, the mean collision time is multiplied by the user-supplied collision_fraction
described above to compute a timestep candidate.  Then for each coordinate direction, the cell size in that direction is
divided by the velocity magnitude in that direction and then multiplied by the user-supplied transit_fraction described above to
compute a timestep candidate.  The cell timestep is set to be the minimum of these candidate timesteps.  The collision and transit fractions
simply reduce the calculated timestep, providing a user-defined safety margin.
</P>
<P>If this fix ID is used as a keyword in the <A HREF = "stats_style.html">stats_style</A> command, the calculated global timestep is printed.  A zero value
indicates that the fix has not yet calculated a global timestep and that the user-suppled timestep is being used.  If the fix
has been invoked, the last calculated value of the timestep will be displayed.  If the mode is set to <I>warn</I>, the calculated timestep will be
displayed but will not be used to advance the simulation.  Note that the <I>dt</I> keyword in the stats_style command will display the actual
timestep being used in the simulation.  The "time" option in the stats_style command prints the current simulation time.
</P>
<P><B>Example:</B>
</P>
<PRE>stats_style     step time dt f_DT cpu np 
</PRE>
<HR>

<P><B>Restart, output info:</B>
</P>
<P>The global time and the current global timestep are written to <A HREF = "restart.html">binary restart files</A>.  This breaks backwards compatibility
with older restart files, even if this fix is not invoked.
</P>
<P>The optional argument <I>store_cell_dt</I> directs the fix to store the cell timestep values in a per-grid vector.  The vector can be
accessed by any command that uses per-grid values from a fix as input.  For example, the values can be output by the
<A HREF = "dump.html">dump grid</A> command.  See <A HREF = "Section_howto.html#howto_4">Section 4.4</A> for an overview of SPARTA
output options.  The <I>store_cell_dt</I> option could be useful for visualizing the cell timestep data on the grid at
a fixed point in time or as the solution evolves.
</P>
<P><B>Default: </B> none
</P>
</HTML>
